// @bun
var Z$=Object.create;var{defineProperty:z1,getPrototypeOf:W$,getOwnPropertyNames:X$}=Object;var B$=Object.prototype.hasOwnProperty;var S0=($,J,Z)=>{Z=$!=null?Z$(W$($)):{};const W=J||!$||!$.__esModule?z1(Z,"default",{value:$,enumerable:!0}):Z;for(let X of X$($))if(!B$.call(W,X))z1(W,X,{get:()=>$[X],enumerable:!0});return W};var B0=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var I1=B0((k$,i0)=>{var O0=function(){},Q$=function($,J,Z){this.fn=$,this.context=J,this.once=Z||!1},O1=function($,J,Z,W,X){if(typeof Z!=="function")throw new TypeError("The listener must be a function");var B=new Q$(Z,W||$,X),Y=f?f+J:J;if(!$._events[Y])$._events[Y]=B,$._eventsCount++;else if(!$._events[Y].fn)$._events[Y].push(B);else $._events[Y]=[$._events[Y],B];return $},E0=function($,J){if(--$._eventsCount===0)$._events=new O0;else delete $._events[J]},g=function(){this._events=new O0,this._eventsCount=0},Y$=Object.prototype.hasOwnProperty,f="~";if(Object.create){if(O0.prototype=Object.create(null),!new O0().__proto__)f=!1}g.prototype.eventNames=function $(){var J=[],Z,W;if(this._eventsCount===0)return J;for(W in Z=this._events)if(Y$.call(Z,W))J.push(f?W.slice(1):W);if(Object.getOwnPropertySymbols)return J.concat(Object.getOwnPropertySymbols(Z));return J};g.prototype.listeners=function $(J){var Z=f?f+J:J,W=this._events[Z];if(!W)return[];if(W.fn)return[W.fn];for(var X=0,B=W.length,Y=new Array(B);X<B;X++)Y[X]=W[X].fn;return Y};g.prototype.listenerCount=function $(J){var Z=f?f+J:J,W=this._events[Z];if(!W)return 0;if(W.fn)return 1;return W.length};g.prototype.emit=function $(J,Z,W,X,B,Y){var D=f?f+J:J;if(!this._events[D])return!1;var Q=this._events[D],G=arguments.length,z,U;if(Q.fn){if(Q.once)this.removeListener(J,Q.fn,void 0,!0);switch(G){case 1:return Q.fn.call(Q.context),!0;case 2:return Q.fn.call(Q.context,Z),!0;case 3:return Q.fn.call(Q.context,Z,W),!0;case 4:return Q.fn.call(Q.context,Z,W,X),!0;case 5:return Q.fn.call(Q.context,Z,W,X,B),!0;case 6:return Q.fn.call(Q.context,Z,W,X,B,Y),!0}for(U=1,z=new Array(G-1);U<G;U++)z[U-1]=arguments[U];Q.fn.apply(Q.context,z)}else{var V=Q.length,N;for(U=0;U<V;U++){if(Q[U].once)this.removeListener(J,Q[U].fn,void 0,!0);switch(G){case 1:Q[U].fn.call(Q[U].context);break;case 2:Q[U].fn.call(Q[U].context,Z);break;case 3:Q[U].fn.call(Q[U].context,Z,W);break;case 4:Q[U].fn.call(Q[U].context,Z,W,X);break;default:if(!z)for(N=1,z=new Array(G-1);N<G;N++)z[N-1]=arguments[N];Q[U].fn.apply(Q[U].context,z)}}}return!0};g.prototype.on=function $(J,Z,W){return O1(this,J,Z,W,!1)};g.prototype.once=function $(J,Z,W){return O1(this,J,Z,W,!0)};g.prototype.removeListener=function $(J,Z,W,X){var B=f?f+J:J;if(!this._events[B])return this;if(!Z)return E0(this,B),this;var Y=this._events[B];if(Y.fn){if(Y.fn===Z&&(!X||Y.once)&&(!W||Y.context===W))E0(this,B)}else{for(var D=0,Q=[],G=Y.length;D<G;D++)if(Y[D].fn!==Z||X&&!Y[D].once||W&&Y[D].context!==W)Q.push(Y[D]);if(Q.length)this._events[B]=Q.length===1?Q[0]:Q;else E0(this,B)}return this};g.prototype.removeAllListeners=function $(J){var Z;if(J){if(Z=f?f+J:J,this._events[Z])E0(this,Z)}else this._events=new O0,this._eventsCount=0;return this};g.prototype.off=g.prototype.removeListener;g.prototype.addListener=g.prototype.on;g.prefixed=f;g.EventEmitter=g;if(typeof i0!=="undefined")i0.exports=g});var W1=B0((D7,E1)=>{var N$=function($){var J=$.indexOf("%");if(J===-1)return $;var Z=$.length,W="",X=0,B=0,Y=J,D=R1;while(J>-1&&J<Z){var Q=S1($[J+1],4),G=S1($[J+2],0),z=Q|G,U=Z1[z];if(D=Z1[256+D+U],B=B<<6|z&Z1[364+U],D===R1)W+=$.slice(X,Y),W+=B<=65535?String.fromCharCode(B):String.fromCharCode(55232+(B>>10),56320+(B&1023)),B=0,X=J+3,J=Y=$.indexOf("%",X);else if(D===F$)return null;else{if(J+=3,J<Z&&$.charCodeAt(J)===37)continue;return null}}return W+$.slice(X)},S1=function($,J){var Z=j$[$];return Z===void 0?255:Z<<J},R1=12,F$=0,Z1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7],j$={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};E1.exports=N$});var g1=B0((G7,x1)=>{var V$=function($){const J=new L1;if(typeof $!=="string")return J;let Z=$.length,W="",X="",B=-1,Y=-1,D=!1,Q=!1,G=!1,z=!1,U=!1,V=0;for(let N=0;N<Z+1;N++)if(V=N!==Z?$.charCodeAt(N):38,V===38){if(U=Y>B,!U)Y=N;if(W=$.slice(B+1,Y),U||W.length>0){if(G)W=W.replace(b1," ");if(D)W=H1(W)||W;if(U){if(X=$.slice(Y+1,N),z)X=X.replace(b1," ");if(Q)X=H1(X)||X}const K=J[W];if(K===void 0)J[W]=X;else if(K.pop)K.push(X);else J[W]=[K,X]}X="",B=N,Y=N,D=!1,Q=!1,G=!1,z=!1}else if(V===61)if(Y<=B)Y=N;else Q=!0;else if(V===43)if(Y>B)z=!0;else G=!0;else if(V===37)if(Y>B)Q=!0;else D=!0;return J},H1=W1(),b1=/\+/g,L1=function(){};L1.prototype=Object.create(null);x1.exports=V$});var y1=B0((z7,f1)=>{var q$=function($){const J=$.length;if(J===0)return"";let Z="",W=0,X=0;$:for(;X<J;X++){let B=$.charCodeAt(X);while(B<128){if(T$[B]!==1){if(W<X)Z+=$.slice(W,X);W=X+1,Z+=i[B]}if(++X===J)break $;B=$.charCodeAt(X)}if(W<X)Z+=$.slice(W,X);if(B<2048){W=X+1,Z+=i[192|B>>6]+i[128|B&63];continue}if(B<55296||B>=57344){W=X+1,Z+=i[224|B>>12]+i[128|B>>6&63]+i[128|B&63];continue}if(++X,X>=J)throw new Error("URI malformed");const Y=$.charCodeAt(X)&1023;W=X+1,B=65536+((B&1023)<<10|Y),Z+=i[240|B>>18]+i[128|B>>12&63]+i[128|B>>6&63]+i[128|B&63]}if(W===0)return $;if(W<J)return Z+$.slice(W);return Z},i=Array.from({length:256},($,J)=>"%"+((J<16?"0":"")+J.toString(16)).toUpperCase()),T$=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]);f1.exports={encodeString:q$}});var u1=B0((K7,k1)=>{var v1=function($){const J=typeof $;if(J==="string")return X1($);else if(J==="bigint")return $.toString();else if(J==="boolean")return $?"true":"false";else if(J==="number"&&Number.isFinite($))return $<1000000000000000000000?""+$:X1(""+$);return""},w$=function($){let J="";if($===null||typeof $!=="object")return J;const Z="&",W=Object.keys($),X=W.length;let B=0;for(let Y=0;Y<X;Y++){const D=W[Y],Q=$[D],G=X1(D)+"=";if(Y)J+=Z;if(Array.isArray(Q)){B=Q.length;for(let z=0;z<B;z++){if(z)J+=Z;J+=G,J+=v1(Q[z])}}else J+=G,J+=v1(Q)}return J},{encodeString:X1}=y1();k1.exports=w$});var B1=B0((U7,N0)=>{var m1=g1(),h1=u1(),c1={parse:m1,stringify:h1};N0.exports=c1;N0.exports.default=c1;N0.exports.parse=m1;N0.exports.stringify=h1});var Y0=($,J)=>({part:$,store:null,inert:J!==void 0?new Map(J.map((Z)=>[Z.part.charCodeAt(0),Z])):null,params:null,wildcardStore:null}),K1=($,J)=>({...$,part:J}),U1=($)=>({paramName:$,store:null,inert:null});class s{root={};history=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g};add($,J,Z){let W;if(typeof J!="string")throw TypeError("Route path must be a string");J===""?J="/":J[0]!=="/"&&(J=`/${J}`),this.history.push([$,J,Z]);let X=J[J.length-1]==="*";X&&(J=J.slice(0,-1));let B=J.split(s.regex.static),Y=J.match(s.regex.params)||[];B[B.length-1]===""&&B.pop(),W=this.root[$]?this.root[$]:this.root[$]=Y0("/");let D=0;for(let Q=0;Q<B.length;++Q){let G=B[Q];if(Q>0){let z=Y[D++].slice(1);if(W.params===null)W.params=U1(z);else if(W.params.paramName!==z)throw Error(`Cannot create route "${J}" with parameter "${z}" because a route already exists with a different parameter name ("${W.params.paramName}") in the same location`);let U=W.params;if(U.inert===null){W=U.inert=Y0(G);continue}W=U.inert}for(let z=0;;){if(z===G.length){if(z<W.part.length){let U=K1(W,W.part.slice(z));Object.assign(W,Y0(G,[U]))}break}if(z===W.part.length){if(W.inert===null)W.inert=new Map;else if(W.inert.has(G.charCodeAt(z))){W=W.inert.get(G.charCodeAt(z)),G=G.slice(z),z=0;continue}let U=Y0(G.slice(z));W.inert.set(G.charCodeAt(z),U),W=U;break}if(G[z]!==W.part[z]){let U=K1(W,W.part.slice(z)),V=Y0(G.slice(z));Object.assign(W,Y0(W.part.slice(0,z),[U,V])),W=V;break}++z}}if(D<Y.length){let Q=Y[D],G=Q.slice(1);if(W.params===null)W.params=U1(G);else if(W.params.paramName!==G)throw Error(`Cannot create route "${J}" with parameter "${G}" because a route already exists with a different parameter name ("${W.params.paramName}") in the same location`);return W.params.store===null&&(W.params.store=Z),W.params.store}return X?(W.wildcardStore===null&&(W.wildcardStore=Z),W.wildcardStore):(W.store===null&&(W.store=Z),W.store)}find($,J){let Z=this.root[$];return Z?p0(J,J.length,Z,0):null}}var p0=($,J,Z,W)=>{let X=Z?.part,B=W+X.length;if(X.length>1){if(B>J)return null;if(X.length<15){for(let Y=1,D=W+1;Y<X.length;++Y,++D)if(X.charCodeAt(Y)!==$.charCodeAt(D))return null}else if($.substring(W,B)!==X)return null}if(B===J)return Z.store!==null?{store:Z.store,params:{}}:Z.wildcardStore!==null?{store:Z.wildcardStore,params:{"*":""}}:null;if(Z.inert!==null){let Y=Z.inert.get($.charCodeAt(B));if(Y!==void 0){let D=p0($,J,Y,B);if(D!==null)return D}}if(Z.params!==null){let Y=Z.params,D=$.indexOf("/",B);if(D!==B){if(D===-1||D>=J){if(Y.store!==null){let Q={};return Q[Y.paramName]=$.substring(B,J),{store:Y.store,params:Q}}}else if(Y.inert!==null){let Q=p0($,J,Y.inert,D);if(Q!==null)return Q.params[Y.paramName]=$.substring(B,D),Q}}}return Z.wildcardStore!==null?{store:Z.wildcardStore,params:{"*":$.substring(B,J)}}:null};var M1=S0(I1(),1);var A1=M1.default;var H0=()=>{let $;return[new Promise((Z)=>{$=Z}),$]},t=()=>{const[$,J]=H0(),[Z,W]=H0(),X=[],B=[];return{signal:$,consume:(Y)=>{switch(Y.type){case"begin":if(Y.unit&&X.length===0)for(let D=0;D<Y.unit;D++){const[Q,G]=H0(),[z,U]=H0();X.push(Q),B.push([(V)=>{G({children:[],end:z,name:V.name??"",skip:!1,time:V.time})},(V)=>{U(V)}])}J({children:X,end:Z,name:Y.name??"",skip:!1,time:Y.time});break;case"end":W(Y.time);break}},consumeChild(Y){switch(Y.type){case"begin":if(!B[0])return;const[D]=B[0];D({children:[],end:Z,name:Y.name??"",skip:!1,time:Y.time});break;case"end":const Q=B.shift();if(!Q)return;Q[1](Y.time)}},resolve(){J({children:[],end:new Promise((Y)=>Y(0)),name:"",skip:!0,time:0});for(let[Y,D]of B)Y({children:[],end:new Promise((Q)=>Q(0)),name:"",skip:!0,time:0}),D(0);W(0)}}},P1=($,J,Z)=>{return async function W(W){if(W.event!=="request"||W.type!=="begin")return;const X=W.id,B=$(),Y=t(),D=t(),Q=t(),G=t(),z=t(),U=t(),V=t(),N=t();Y.consume(W);const K=(j)=>{if(j.id===X)switch(j.event){case"request":Y.consume(j);break;case"request.unit":Y.consumeChild(j);break;case"parse":D.consume(j);break;case"parse.unit":D.consumeChild(j);break;case"transform":Q.consume(j);break;case"transform.unit":Q.consumeChild(j);break;case"beforeHandle":G.consume(j);break;case"beforeHandle.unit":G.consumeChild(j);break;case"handle":z.consume(j);break;case"afterHandle":U.consume(j);break;case"afterHandle.unit":U.consumeChild(j);break;case"error":V.consume(j);break;case"error.unit":V.consumeChild(j);break;case"response":if(j.type==="begin")Y.resolve(),D.resolve(),Q.resolve(),G.resolve(),z.resolve(),U.resolve(),V.resolve();else B.off("event",K);N.consume(j);break;case"response.unit":N.consumeChild(j);break;case"exit":Y.resolve(),D.resolve(),Q.resolve(),G.resolve(),z.resolve(),U.resolve(),V.resolve();break}};B.on("event",K),await Z({id:X,context:W.ctx,set:W.ctx?.set,store:W.ctx?.store,time:W.time,request:Y.signal,parse:D.signal,transform:Q.signal,beforeHandle:G.signal,handle:z.signal,afterHandle:U.signal,error:V.signal,response:N.signal}),B.emit(`res${X}.${J}`,void 0)}};import{Value as $1} from"@sinclair/typebox/value";import{Kind as n0} from"@sinclair/typebox";import{Value as y0} from"@sinclair/typebox/value";import{TypeCompiler as V1} from"@sinclair/typebox/compiler";var D$=function($,J){if(typeof $!=="string")throw new TypeError("argument str must be a string");var Z={},W=J||{},X=W.decode||z$,B=0;while(B<$.length){var Y=$.indexOf("=",B);if(Y===-1)break;var D=$.indexOf(";",B);if(D===-1)D=$.length;else if(D<Y){B=$.lastIndexOf(";",Y-1)+1;continue}var Q=$.slice(B,Y).trim();if(Z[Q]===void 0){var G=$.slice(Y+1,D).trim();if(G.charCodeAt(0)===34)G=G.slice(1,-1);Z[Q]=O$(G,X)}B=D+1}return Z},G$=function($,J,Z){var W=Z||{},X=W.encode||K$;if(typeof X!=="function")throw new TypeError("option encode is invalid");if(!b0.test($))throw new TypeError("argument name is invalid");var B=X(J);if(B&&!b0.test(B))throw new TypeError("argument val is invalid");var Y=$+"="+B;if(W.maxAge!=null){var D=W.maxAge-0;if(isNaN(D)||!isFinite(D))throw new TypeError("option maxAge is invalid");Y+="; Max-Age="+Math.floor(D)}if(W.domain){if(!b0.test(W.domain))throw new TypeError("option domain is invalid");Y+="; Domain="+W.domain}if(W.path){if(!b0.test(W.path))throw new TypeError("option path is invalid");Y+="; Path="+W.path}if(W.expires){var Q=W.expires;if(!U$(Q)||isNaN(Q.valueOf()))throw new TypeError("option expires is invalid");Y+="; Expires="+Q.toUTCString()}if(W.httpOnly)Y+="; HttpOnly";if(W.secure)Y+="; Secure";if(W.partitioned)Y+="; Partitioned";if(W.priority){var G=typeof W.priority==="string"?W.priority.toLowerCase():W.priority;switch(G){case"low":Y+="; Priority=Low";break;case"medium":Y+="; Priority=Medium";break;case"high":Y+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(W.sameSite){var z=typeof W.sameSite==="string"?W.sameSite.toLowerCase():W.sameSite;switch(z){case!0:Y+="; SameSite=Strict";break;case"lax":Y+="; SameSite=Lax";break;case"strict":Y+="; SameSite=Strict";break;case"none":Y+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return Y},z$=function($){return $.indexOf("%")!==-1?decodeURIComponent($):$},K$=function($){return encodeURIComponent($)},U$=function($){return _$.call($)==="[object Date]"||$ instanceof Date},O$=function($,J){try{return J($)}catch(Z){return $}};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var L0=D$,x0=G$;var _$=Object.prototype.toString,b0=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;class u{$;J;name;setter;constructor($,J={}){this._value=$;this.property=J}get(){return this._value}get value(){return this._value}set value($){if(typeof $==="object"){if(JSON.stringify(this.value)===JSON.stringify($))return}else if(this.value===$)return;this._value=$,this.sync()}add($){const J=Object.assign(this.property,typeof $==="function"?$(Object.assign(this.property,this.value)):$);if("value"in J)this._value=J.value,delete J.value;return this.property=J,this.sync()}set($){const J=typeof $==="function"?$(Object.assign(this.property,this.value)):$;if("value"in J)this._value=J.value,delete J.value;return this.property=J,this.sync()}remove($){if(this.value===void 0)return;this.set({domain:$?.domain,expires:new Date(0),maxAge:0,path:$?.path,sameSite:$?.sameSite,secure:$?.secure,value:""})}get domain(){return this.property.domain}set domain($){if(this.property.domain===$)return;this.property.domain=$,this.sync()}get expires(){return this.property.expires}set expires($){if(this.property.expires?.getTime()===$?.getTime())return;this.property.expires=$,this.sync()}get httpOnly(){return this.property.httpOnly}set httpOnly($){if(this.property.domain===$)return;this.property.httpOnly=$,this.sync()}get maxAge(){return this.property.maxAge}set maxAge($){if(this.property.maxAge===$)return;this.property.maxAge=$,this.sync()}get path(){return this.property.path}set path($){if(this.property.path===$)return;this.property.path=$,this.sync()}get priority(){return this.property.priority}set priority($){if(this.property.priority===$)return;this.property.priority=$,this.sync()}get sameSite(){return this.property.sameSite}set sameSite($){if(this.property.sameSite===$)return;this.property.sameSite=$,this.sync()}get secure(){return this.property.secure}set secure($){if(this.property.secure===$)return;this.property.secure=$,this.sync()}toString(){return typeof this.value==="object"?JSON.stringify(this.value):this.value?.toString()??""}sync(){if(!this.name||!this.setter)return this;if(!this.setter.cookie)this.setter.cookie={[this.name]:Object.assign(this.property,{value:this.toString()})};else this.setter.cookie[this.name]=Object.assign(this.property,{value:this.toString()});return this}}var F1=($,J,Z)=>new Proxy($,{get(W,X){if(X in W)return W[X];const B=new u(void 0,Z?{...Z}:void 0);return B.setter=J,B.name=X,B},set(W,X,B){if(!(B instanceof u))return!1;if(!J.cookie)J.cookie={};return B.setter=J,B.name=X,B.sync(),W[X]=B,!0}}),g0=async($,J,{secret:Z,sign:W,...X}={})=>{if(!J)return F1({},$,X);const B={},Y=typeof Z==="string";if(W&&W!==!0&&!Array.isArray(W))W=[W];const D=Object.keys(L0(J));for(let Q=0;Q<D.length;Q++){const G=D[Q];let z=L0(J)[G];if(W===!0||W?.includes(G)){if(!Z)throw new Error("No secret is provided to cookie plugin");if(Y){if(z=await l0(z,Z),z===!1)throw new I0(G)}else{let N=!0;for(let K=0;K<Z.length;K++){const j=await l0(z,Z[K]);if(j!==!1){z=j,N=!1;break}}if(N)throw new I0(G)}}if(z===void 0)continue;const U=z.charCodeAt(0);if(U===123||U===91)try{const N=new u(JSON.parse(z));N.setter=$,N.name=G,B[G]=N;continue}catch{}if(f0(z))z=+z;else if(z==="true")z=!0;else if(z==="false")z=!1;const V=new u(z,X);V.setter=$,V.name=G,B[G]=V}return F1(B,$)};var M0="toJSON"in new Headers,m=($)=>{for(let J in $)return!0;return!1},A0=($,J)=>{const Z=$.size;if(Z&&J&&J.status!==206&&J.status!==304&&J.status!==412&&J.status!==416||!J&&Z){if(J){if(J.headers instanceof Headers){if(M0)J.headers=J.headers.toJSON();else for(let[W,X]of J.headers.entries())if(W in J.headers)J.headers[W]=X}return new Response($,{status:J.status,headers:Object.assign({"accept-ranges":"bytes","content-range":`bytes 0-${Z-1}/${Z}`},J.headers)})}return new Response($,{headers:{"accept-ranges":"bytes","content-range":`bytes 0-${Z-1}/${Z}`}})}return new Response($)},N1=($,J)=>{if(!$||!Array.isArray(J))return $;$.delete("Set-Cookie");for(let Z=0;Z<J.length;Z++){const W=J[Z].indexOf("=");$.append("Set-Cookie",`${J[Z].slice(0,W)}=${J[Z].slice(W+1)}`)}return $},j1=($)=>{if(!$||typeof $!=="object"||!m($))return;const J=[];for(let[Z,W]of Object.entries($)){if(!Z||!W)continue;if(Array.isArray(W.value))for(let X=0;X<W.value.length;X++){let B=W.value[X];if(B===void 0||B===null)continue;if(typeof B==="object")B=JSON.stringify(B);J.push(x0(Z,B,W))}else{let X=W.value;if(X===void 0||X===null)continue;if(typeof X==="object")X=JSON.stringify(X);J.push(x0(Z,W.value,W))}}if(J.length===0)return;if(J.length===1)return J[0];return J},k=($,J)=>{if($?.[$.$passthrough])$=$[$.$passthrough];if($?.[c])J.status=$[c],$=$.response;if(m(J.headers)||J.status!==200||J.redirect||J.cookie){if(typeof J.status==="string")J.status=P0[J.status];if(J.redirect){if(J.headers.Location=J.redirect,!J.status||J.status<300||J.status>=400)J.status=302}if(J.cookie&&m(J.cookie))J.headers["Set-Cookie"]=j1(J.cookie);if(J.headers["Set-Cookie"]&&Array.isArray(J.headers["Set-Cookie"]))J.headers=N1(new Headers(J.headers),J.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,J);case"Blob":return A0($,J);case"Object":case"Array":return Response.json($,J);case"ReadableStream":if(!J.headers["content-type"]?.startsWith("text/event-stream"))J.headers["content-type"]="text/event-stream; charset=utf-8";return new Response($,J);case void 0:if(!$)return new Response("",J);return Response.json($,J);case"Response":const Z={...J.headers};if(M0)J.headers=$.headers.toJSON();else for(let[X,B]of $.headers.entries())if(X in J.headers)J.headers[X]=B;for(let X in Z)$.headers.append(X,Z[X]);return $;case"Error":return h($,J);case"Promise":return $.then((X)=>k(X,J));case"Function":return k($(),J);case"Number":case"Boolean":return new Response($.toString(),J);case"Cookie":if($ instanceof u)return new Response($.value,J);return new Response($?.toString(),J);default:if($ instanceof Response){const X={...J.headers};if(M0)J.headers=$.headers.toJSON();else for(let[B,Y]of $.headers.entries())if(B in J.headers)J.headers[B]=Y;for(let B in X)$.headers.append(B,X[B]);return $}if($ instanceof Promise)return $.then((X)=>k(X,J));if($ instanceof Error)return h($,J);const W=JSON.stringify($);if(W.charCodeAt(0)===123){if(!J.headers["Content-Type"])J.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),J)}return new Response(W,J)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return A0($,J);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return h($,J);case"Promise":return $.then((W)=>{const X=l(W);if(X!==void 0)return X;return new Response("")});case"Function":return l($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof u)return new Response($.value,J);return new Response($?.toString(),J);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((W)=>k(W,J));if($ instanceof Error)return h($,J);const Z=JSON.stringify($);if(Z.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(Z)}},y=($,J)=>{if($===void 0||$===null)return;if($?.$passthrough)$=$[$.$passthrough];if($?.[c])J.status=$[c],$=$.response;if(m(J.headers)||J.status!==200||J.redirect||J.cookie){if(typeof J.status==="string")J.status=P0[J.status];if(J.redirect){if(J.headers.Location=J.redirect,!J.status||J.status<300||J.status>=400)J.status=302}if(J.cookie&&m(J.cookie))J.headers["Set-Cookie"]=j1(J.cookie);if(J.headers["Set-Cookie"]&&Array.isArray(J.headers["Set-Cookie"]))J.headers=N1(new Headers(J.headers),J.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,J);case"Blob":return A0($,J);case"Object":case"Array":return Response.json($,J);case"ReadableStream":if(!J.headers["content-type"]?.startsWith("text/event-stream"))J.headers["content-type"]="text/event-stream; charset=utf-8";return new Response($,J);case void 0:if(!$)return;return Response.json($,J);case"Response":const Z=Object.assign({},J.headers);if(M0)J.headers=$.headers.toJSON();else for(let[X,B]of $.headers.entries())if(!(X in J.headers))J.headers[X]=B;for(let X in Z)$.headers.append(X,Z[X]);if($.status!==J.status)J.status=$.status;return $;case"Promise":return $.then((X)=>{const B=y(X,J);if(B!==void 0)return B;return});case"Error":return h($,J);case"Function":return y($(),J);case"Number":case"Boolean":return new Response($.toString(),J);case"Cookie":if($ instanceof u)return new Response($.value,J);return new Response($?.toString(),J);default:if($ instanceof Response){const X={...J.headers};if(M0)J.headers=$.headers.toJSON();else for(let[B,Y]of $.headers.entries())if(B in J.headers)J.headers[B]=Y;for(let B in X)$.headers.append(B,X[B]);return $}if($ instanceof Promise)return $.then((X)=>y(X,J));if($ instanceof Error)return h($,J);const W=JSON.stringify($);if(W.charCodeAt(0)===123){if(!J.headers["Content-Type"])J.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),J)}return new Response(W,J)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return A0($,J);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Promise":return $.then((W)=>{const X=y(W,J);if(X!==void 0)return X;return});case"Error":return h($,J);case"Function":return l($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof u)return new Response($.value,J);return new Response($?.toString(),J);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((W)=>y(W,J));if($ instanceof Error)return h($,J);const Z=JSON.stringify($);if(Z.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(Z)}},l=($)=>{if($?.$passthrough)$=$[$.$passthrough];if($?.[c])return k($.response,{status:$[c],headers:{}});switch($?.constructor?.name){case"String":return new Response($);case"Blob":return A0($);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return h($);case"Promise":return $.then(l);case"Function":return l($());case"Number":case"Boolean":return new Response($.toString());default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then(l);if($ instanceof Error)return h($);const J=JSON.stringify($);if(J.charCodeAt(0)===123)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}});return new Response(J)}},h=($,J)=>new Response(JSON.stringify({name:$?.name,message:$?.message,cause:$?.cause}),{status:J?.status!==200?J?.status??500:500,headers:J?.headers});var r0=($)=>$&&typeof $==="object"&&!Array.isArray($),t0=($,J)=>{const Z=new URL($);return Z.pathname=J,Z.toString()},I$=($)=>typeof $==="function"&&/^\s*class\s+/.test($.toString())||$.toString().startsWith("[object ")||m(Object.getPrototypeOf($)),d=($,J,{skipKeys:Z}={})=>{if(r0($)&&r0(J))for(let[W,X]of Object.entries(J)){if(Z?.includes(W))continue;if(!r0(X)){$[W]=X;continue}if(!(W in $)){$[W]=X;continue}if(I$(X)){$[W]=X;continue}$[W]=d($[W],X)}return $},T1=($,J)=>d($,J,{skipKeys:["properties"]}),H=($,J)=>{if(!$)return[];const Z=[...Array.isArray($)?$:[$]],W=[];for(let X of Z)if(X.$elysiaChecksum)W.push(X.$elysiaChecksum);for(let X of Array.isArray(J)?J:[J])if(!W.includes(X?.$elysiaChecksum))Z.push(X);return Z},a0=["start","request","parse","transform","resolve","beforeHandle","afterHandle","onResponse","mapResponse","trace","error","stop","body","headers","params","query","response","type","detail"],a=($,J)=>{return{...$,...J,body:J?.body??$?.body,headers:J?.headers??$?.headers,params:J?.params??$?.params,query:J?.query??$?.query,response:J?.response??$?.response,type:$?.type||J?.type,detail:d(J?.detail??{},$?.detail??{}),parse:H($?.parse??[],J?.parse??[]),transform:H($?.transform??[],J?.transform??[]),beforeHandle:H($?.beforeHandle??[],J?.beforeHandle??[]),afterHandle:H($?.afterHandle??[],J?.afterHandle??[]),onResponse:H($?.onResponse??[],J?.onResponse??[]),mapResponse:H($?.mapResponse??[],J?.mapResponse??[]),trace:H($?.trace??[],J?.trace??[]),error:H($?.error??[],J?.error??[])}},p=($,{models:J={},additionalProperties:Z=!1,dynamic:W=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in J))return;const X=typeof $==="string"?J[$]:$;if(X.type==="object"&&"additionalProperties"in X===!1)X.additionalProperties=Z;if(W)return{schema:X,references:"",checkFunc:()=>{},code:"",Check:(B)=>y0.Check(X,B),Errors:(B)=>y0.Errors(X,B),Code:()=>""};return V1.Compile(X,Object.values(J))},s0=($,{models:J={},additionalProperties:Z=!1,dynamic:W=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in J))return;const X=typeof $==="string"?J[$]:$,B=(D,Q)=>{if(W)return{schema:D,references:"",checkFunc:()=>{},code:"",Check:(G)=>y0.Check(D,G),Errors:(G)=>y0.Errors(D,G),Code:()=>""};return V1.Compile(D,Q)};if(n0 in X){if("additionalProperties"in X===!1)X.additionalProperties=Z;return{200:B(X,Object.values(J))}}const Y={};return Object.keys(X).forEach((D)=>{const Q=X[+D];if(typeof Q==="string"){if(Q in J){const G=J[Q];G.type==="object"&&"additionalProperties"in G,Y[+D]=n0 in G?B(G,Object.values(J)):G}return}if(Q.type==="object"&&"additionalProperties"in Q===!1)Q.additionalProperties=Z;Y[+D]=n0 in Q?B(Q,Object.values(J)):Q}),Y},M$=typeof Bun!=="undefined",A$=M$&&typeof Bun.hash==="function",_0=($)=>{if(A$)return Bun.hash($);let J=9;for(let Z=0;Z<$.length;)J=Math.imul(J^$.charCodeAt(Z++),387420489);return J=J^J>>>9},v0=($,J,Z)=>{const W=(X)=>{if(Z&&!X.$elysiaChecksum)X.$elysiaChecksum=Z;return X};return{...$,...J,start:H($.start,("start"in J?J.start??[]:[]).map(W)),request:H($.request,("request"in J?J.request??[]:[]).map(W)),parse:H($.parse,"parse"in J?J?.parse??[]:[]).map(W),transform:H($.transform,(J?.transform??[]).map(W)),beforeHandle:H($.beforeHandle,(J?.beforeHandle??[]).map(W)),afterHandle:H($.afterHandle,(J?.afterHandle??[]).map(W)),mapResponse:H($.mapResponse,(J?.mapResponse??[]).map(W)),onResponse:H($.onResponse,(J?.onResponse??[]).map(W)),trace:$.trace,error:H($.error,(J?.error??[]).map(W)),stop:H($.stop,("stop"in J?J.stop??[]:[]).map(W))}};var q1=($,J=!0)=>{if(!$)return $;if(typeof $==="function"){if(J)$.$elysiaHookType="global";else $.$elysiaHookType=void 0;return $}return $.map((Z)=>{if(J)Z.$elysiaHookType="global";else Z.$elysiaHookType=void 0;return Z})},Q0=($)=>{if(!$)return $;if(typeof $==="function")return $.$elysiaHookType==="global"?$:void 0;return $.filter((J)=>J.$elysiaHookType==="global")},o0=($)=>{return{...$,type:$?.type,detail:$?.detail,parse:Q0($?.parse),transform:Q0($?.transform),beforeHandle:Q0($?.beforeHandle),afterHandle:Q0($?.afterHandle),onResponse:Q0($?.onResponse),error:Q0($?.error)}},P0={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},D0=async($,J)=>{if(typeof $!=="string")throw new TypeError("Cookie value must be provided as a string.");if(J===null)throw new TypeError("Secret key must be provided.");const Z=new TextEncoder,W=await crypto.subtle.importKey("raw",Z.encode(J),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),X=await crypto.subtle.sign("HMAC",W,Z.encode($)),B=Array.from(new Uint8Array(X)),Y=btoa(String.fromCharCode(...B));return`${$}.${Y.replace(/=+$/,"")}`},l0=async($,J)=>{if(typeof $!=="string")throw new TypeError("Signed cookie string must be provided.");if(J===null)throw new TypeError("Secret key must be provided.");const Z=$.slice(0,$.lastIndexOf("."));return await D0(Z,J)===$?Z:!1},e0=($,J,Z=J)=>{for(let[W,X]of Object.entries(J??{})){if(a0.includes(W)||!(W in $))continue;if(typeof $[W]==="function")$[W](X);else if(typeof $[W]==="object")e0($[W],X,Z)}},f0=($)=>$.trim().length!==0&&!Number.isNaN(Number($));var w1=typeof Bun!=="undefined"?Bun.env:typeof process!=="undefined"?process?.env:void 0,G0=Symbol("ElysiaErrorCode"),c=Symbol("ElysiaResponse"),F0=(w1?.NODE_ENV??w1?.ENV)==="production",P$=($,J)=>({[c]:P0[$]??$,response:J});class k0 extends Error{code="INTERNAL_SERVER_ERROR";status=500;constructor($){super($??"INTERNAL_SERVER_ERROR")}}class o extends Error{code="NOT_FOUND";status=404;constructor($){super($??"NOT_FOUND")}}class C1 extends Error{code="PARSE";status=400;constructor($){super($??"PARSE")}}class I0 extends Error{$;code="INVALID_COOKIE_SIGNATURE";status=400;constructor($,J){super(J??`"${$}" has invalid cookie signature`);this.key=$}}class S extends Error{$;J;Z;code="VALIDATION";status=400;constructor($,J,Z){const W=F0?void 0:("Errors"in J)?J.Errors(Z).First():$1.Errors(J,Z).First(),X=W?.schema.error?typeof W.schema.error==="function"?W.schema.error($,J,Z):W.schema.error:void 0,B=W?.path?.slice(1)||"root";let Y="";if(X)Y=typeof X==="object"?JSON.stringify(X):X+"";else if(F0)Y=JSON.stringify({type:$,message:W?.message});else Y=JSON.stringify({type:$,at:B,message:W?.message,expected:$1.Create(J.schema),found:Z,errors:[...J.Errors(Z)]},null,2);super(Y);this.type=$;this.validator=J;this.value=Z;Object.setPrototypeOf(this,S.prototype)}get all(){return[...this.validator.Errors(this.value)]}static simplifyModel($){const J="schema"in $?$.schema:$;try{return $1.Create(J)}catch{return J}}get model(){return S.simplifyModel(this.validator)}toResponse($){return new Response(this.message,{status:400,headers:$})}}var J1={open($){$.data.open?.($)},message($,J){$.data.message?.($,J)},drain($){$.data.drain?.($)},close($,J,Z){$.data.close?.($,J,Z)}};class z0{$;J;validator;constructor($,J){this.raw=$;this.data=J;if(this.validator=$.data.validator,$.data.id)this.id=$.data.id;else{const Z=new Uint32Array(1);crypto.getRandomValues(Z),this.id=Z[0].toString()}}get id(){return this.raw.data.id}set id($){this.raw.data.id=$}get publish(){return($,J=void 0,Z)=>{if(this.validator?.Check(J)===!1)throw new S("message",this.validator,J);if(typeof J==="object")J=JSON.stringify(J);return this.raw.publish($,J,Z),this}}get send(){return($)=>{if(this.validator?.Check($)===!1)throw new S("message",this.validator,$);if(Buffer.isBuffer($))return this.raw.send($),this;if(typeof $==="object")$=JSON.stringify($);return this.raw.send($),this}}get subscribe(){return($)=>{return this.raw.subscribe($),this}}get unsubscribe(){return($)=>{return this.raw.unsubscribe($),this}}get cork(){return($)=>{return this.raw.cork($),this}}get close(){return()=>{return this.raw.close(),this}}get terminate(){return this.raw.terminate.bind(this.raw)}get isSubscribed(){return this.raw.isSubscribed.bind(this.raw)}get remoteAddress(){return this.raw.remoteAddress}}var d1=S0(B1(),1),p1=S0(W1(),1);import{Value as j0} from"@sinclair/typebox/value";var C$=(new Headers()).toJSON,i1=new RegExp(" (\\w+) = context","g"),l1={value:0},n1=({hasTrace:$,hasTraceSet:J=!1,addFn:Z,condition:W={}})=>{if($)return Z("\nconst reporter = getReporter()\n"),(X,{name:B,attribute:Y="",unit:D=0}={})=>{const Q=X.indexOf("."),G=Q===-1;if(X!=="request"&&X!=="response"&&!W[G?X:X.slice(0,Q)])return()=>{if(J&&X==="afterHandle")Z("\nawait traceDone\n")};if(G)B||=X;else B||="anonymous";Z("\n"+`reporter.emit('event', {
					id,
					event: '${X}',
					type: 'begin',
					name: '${B}',
					time: performance.now(),
					${G?`unit: ${D},`:""}
					${Y}
				})`.replace(/(\t| |\n)/g,"")+"\n");let z=!1;return()=>{if(z)return;if(z=!0,Z("\n"+`reporter.emit('event', {
							id,
							event: '${X}',
							type: 'end',
							time: performance.now()
						})`.replace(/(\t| |\n)/g,"")+"\n"),J&&X==="afterHandle")Z("\nawait traceDone\n")}};else return()=>()=>{}},V0=($)=>{const J=$.indexOf(")");if($.charCodeAt(J+2)===61&&$.charCodeAt(J+5)!==123)return!0;return $.includes("return")},R$=($,{injectResponse:J=""}={})=>({composeValidation:(Z,W=`c.${Z}`)=>$?`c.set.status = 400; throw new ValidationError(
'${Z}',
${Z},
${W}
)`:`c.set.status = 400; return new ValidationError(
	'${Z}',
	${Z},
	${W}
).toResponse(c.set.headers)`,composeResponseValidation:(Z="r")=>{const W=$?`throw new ValidationError(
'response',
response[c.set.status],
${Z}
)`:`return new ValidationError(
'response',
response[c.set.status],
${Z}
).toResponse(c.set.headers)`;return`\n${J}
		if(!(${Z} instanceof Response) && response[c.set.status]?.Check(${Z}) === false) {
	if(!(response instanceof Error))
		${W}
}\n`}}),b=($,J)=>{if(J.startsWith("[object "))return!1;if(J=J.trimStart(),J=J.replaceAll(/^async /g,""),/^(\w+)\(/g.test(J))J=J.slice(J.indexOf("("));const Z=J.charCodeAt(0)===40||J.startsWith("function")?J.slice(J.indexOf("(")+1,J.indexOf(")")):J.slice(0,J.indexOf("=")-1);if(Z==="")return!1;const W=Z.charCodeAt(0)===123?Z.indexOf("..."):-1;if(Z.charCodeAt(0)===123){if(Z.includes($))return!0;if(W===-1)return!1}if(J.match(new RegExp(`${Z}(.${$}|\\["${$}"\\])`)))return!0;const X=W!==-1?Z.slice(W+3,Z.indexOf(" ",W+3)):void 0;if(J.match(new RegExp(`${X}(.${$}|\\["${$}"\\])`)))return!0;const B=[Z];if(X)B.push(X);for(let D of J.matchAll(i1))B.push(D[1]);const Y=new RegExp(`{.*?} = (${B.join("|")})`,"g");for(let[D]of J.matchAll(Y))if(D.includes(`{ ${$}`)||D.includes(`, ${$}`))return!0;return!1},T0=($)=>{if($=$.trimStart(),$.startsWith("[object"))return!1;if($=$.replaceAll(/^async /g,""),/^(\w+)\(/g.test($))$=$.slice($.indexOf("("));const J=$.charCodeAt(0)===40||$.startsWith("function")?$.slice($.indexOf("(")+1,$.indexOf(")")):$.slice(0,$.indexOf("=")-1);if(J==="")return!1;const Z=J.charCodeAt(0)===123?J.indexOf("..."):-1,W=Z!==-1?J.slice(Z+3,J.indexOf(" ",Z+3)):void 0,X=[J];if(W)X.push(W);for(let Y of $.matchAll(i1))X.push(Y[1]);for(let Y of X)if(new RegExp(`\\b\\w+\\([^)]*\\b${Y}\\b[^)]*\\)`).test($))return!0;const B=new RegExp(`{.*?} = (${X.join("|")})`,"g");for(let[Y]of $.matchAll(B))if(new RegExp(`\\b\\w+\\([^)]*\\b${Y}\\b[^)]*\\)`).test($))return!0;return!1},K0=Symbol.for("TypeBox.Kind"),u0=($,J)=>{if(!J)return;if(K0 in J&&J[K0]===$)return!0;if(J.type==="object"){const Z=J.properties;for(let W of Object.keys(Z)){const X=Z[W];if(X.type==="object"){if(u0($,X))return!0}else if(X.anyOf){for(let B=0;B<X.anyOf.length;B++)if(u0($,X.anyOf[B]))return!0}if(K0 in X&&X[K0]===$)return!0}return!1}return J.properties&&K0 in J.properties&&J.properties[K0]===$},e=($,J)=>{if(!J)return;if(J.type==="object"){const Z=J.properties;if(!Z)return!1;for(let W of Object.keys(Z)){const X=Z[W];if($ in X)return!0;if(X.type==="object"){if(e($,X))return!0}else if(X.anyOf){for(let B=0;B<X.anyOf.length;B++)if(e($,X.anyOf[B]))return!0}}return!1}return $ in J},Y1=Symbol.for("TypeBox.Transform"),$0=($)=>{if(!$)return;if($.type==="object"&&$.properties){const J=$.properties;for(let Z of Object.keys(J)){const W=J[Z];if(W.type==="object"){if($0(W))return!0}else if(W.anyOf){for(let B=0;B<W.anyOf.length;B++)if($0(W.anyOf[B]))return!0}if(Y1 in W)return!0}return!1}return Y1 in $||$.properties&&Y1 in $.properties},S$=($)=>{if(!$)return;const J=$?.schema;if(J&&"anyOf"in J){let Z=!1;const W=J.anyOf[0].type;for(let X of J.anyOf)if(X.type!==W){Z=!0;break}if(!Z)return W}return $.schema?.type},E$=/(?:return|=>) \S+\(/g,L=($)=>{if($.constructor.name==="AsyncFunction")return!0;const J=$.toString();if(J.includes("=> response.clone("))return!1;return!!J.match(E$)},H$=($)=>{if(!$.includes("query: {")||$.includes("query,")||$.includes("query }"))return!1;const J=$.indexOf("query: {");return $=$.slice(J+9),$=$.slice(0,$.indexOf("}")),$.split(",").map((Z)=>{const W=Z.indexOf(":");if(W===-1)return Z.trim();return Z.slice(0,W).trim()})},r1=({path:$,method:J,hooks:Z,validator:W,handler:X,handleError:B,definitions:Y,schema:D,onRequest:Q,config:G,getReporter:z,setHeader:U})=>{const V=G.forceErrorEncapsulation||Z.error.length>0||typeof Bun==="undefined"||Z.onResponse.length>0||!!Z.trace.length,N=typeof X==="function",K=N?"handler(c)":"handler",j=Z.onResponse.length?`\n;(async () => {${Z.onResponse.map((I,M)=>`await res${M}(c)`).join(";")}})();\n`:"",O=Z.trace.map((I)=>I.toString());let P=!1;if(N&&T0(X.toString()))P=!0;if(!P)for(let[I,M]of Object.entries(Z)){if(!Array.isArray(M)||!M.length||!["parse","transform","beforeHandle","afterHandle","onResponse"].includes(I))continue;for(let F of M){if(typeof F!=="function")continue;if(T0(F.toString())){P=!0;break}}if(P)break}const A={parse:O.some((I)=>b("parse",I)),transform:O.some((I)=>b("transform",I)),handle:O.some((I)=>b("handle",I)),beforeHandle:O.some((I)=>b("beforeHandle",I)),afterHandle:O.some((I)=>b("afterHandle",I)),error:V||O.some((I)=>b("error",I))},T=Z.trace.length>0;let _="";const v=W||J!=="GET"&&J!=="HEAD"?[X,...Z.transform,...Z.beforeHandle,...Z.afterHandle,...Z.mapResponse].map((I)=>typeof I==="function"?I.toString():`${I}`):[],Z0=J!=="GET"&&J!=="HEAD"&&(P||Z.type!=="none"&&(!!W.body||!!Z.type||v.some((I)=>b("body",I)))),h0=P||W.headers||v.some((I)=>b("headers",I))||U&&Object.keys(U).length,q0=P||!!W.cookie||v.some((I)=>b("cookie",I)),x=W?.cookie?.schema;let r="";if(x?.sign){if(!x.secrets)throw new Error(`t.Cookie required secret which is not set in (${J}) ${$}.`);const I=!x.secrets?void 0:typeof x.secrets==="string"?x.secrets:x.secrets[0];if(r+=`const _setCookie = c.set.cookie
		if(_setCookie) {`,x.sign===!0)r+=`for(const [key, cookie] of Object.entries(_setCookie)) {
				c.set.cookie[key].value = await signCookie(cookie.value, '${I}')
			}`;else for(let M of x.sign)r+=`if(_setCookie['${M}']?.value) { c.set.cookie['${M}'].value = await signCookie(_setCookie['${M}'].value, '${I}') }\n`;r+="}\n"}const{composeValidation:W0,composeResponseValidation:w0}=R$(V);if(h0)_+=C$?"c.headers = c.request.headers.toJSON()\n":`c.headers = {}
                for (const [key, value] of c.request.headers.entries())
					c.headers[key] = value
				`;if(q0){const I=(F,q)=>{const C=x?.[F]??q;if(!C)return typeof q==="string"?`${F}: "${q}",`:`${F}: ${q},`;if(typeof C==="string")return`${F}: '${C}',`;if(C instanceof Date)return`${F}: new Date(${C.getTime()}),`;return`${F}: ${C},`},M=x?`{
			secret: ${x.secrets!==void 0?typeof x.secrets==="string"?`'${x.secrets}'`:"["+x.secrets.reduce((F,q)=>F+`'${q}',`,"")+"]":"undefined"},
			sign: ${x.sign===!0?!0:x.sign!==void 0?"["+x.sign.reduce((F,q)=>F+`'${q}',`,"")+"]":"undefined"},
			${I("domain")}
			${I("expires")}
			${I("httpOnly")}
			${I("maxAge")}
			${I("path","/")}
			${I("priority")}
			${I("sameSite")}
			${I("secure")}
		}`:"undefined";if(h0)_+=`\nc.cookie = await parseCookie(c.set, c.headers.cookie, ${M})\n`;else _+=`\nc.cookie = await parseCookie(c.set, c.request.headers.get('cookie'), ${M})\n`}if(P||W.query||v.some((I)=>b("query",I))){let I=[],M=!1;if(W.query&&W.query.schema.type==="object")I=Object.keys(W.query.schema.properties);else for(let F of v){const q=H$(F);if(!q){M=!0;continue}for(let C of q)if(I.indexOf(C)===-1)I.push(C)}if(!M&&I.length)_+=`
			let requestUrl = c.request.url.slice(c.qi + 1)
			if(requestUrl.includes('+')) requestUrl = requestUrl.replaceAll('+', ' ')

			if(c.qi !== -1) {	
				const url = decodeURIComponent(requestUrl)
				let memory = 0

				${I.map((F,q)=>`
						memory = url.indexOf('${F}=')

						const a${q} = memory === -1 ? undefined : url.slice(memory = memory + ${F.length+1}, (memory = url.indexOf('&', memory)) === -1 ? undefined : memory)`).join("\n")}

				c.query = {
					${I.map((F,q)=>`${F}: a${q}`).join(", ")}
				}
			} else {
				c.query = {}
			}`;else _+="c.query = c.qi !== -1 ? parseQuery(decodeURIComponent(c.request.url.slice(c.qi + 1))) : {}"}const C0=Z.trace.map((I)=>I.toString()).some((I)=>b("set",I)||T0(I));P||Z.trace.some((I)=>b("set",I.toString()));const R0=U&&Object.keys(U).length||C0||q0||v.some((I)=>b("set",I))||Q.some((I)=>b("set",I.toString()));if(T)_+="\nconst id = c.$$requestId\n";const E=n1({hasTrace:T,hasTraceSet:C0,condition:A,addFn:(I)=>{_+=I}});if(_+=V?"\n try {\n":"",C0){_+="\nconst traceDone = Promise.all([";for(let I=0;I<Z.trace.length;I++)_+=`new Promise(r => { reporter.once(\`res\${id}.${I}\`, r) }),`;_+="])\n"}const X0=typeof X==="function"&&L(X),c0=q0||Z0||C0||X0||!!Z.mapResponse.length||Z.parse.length>0||Z.afterHandle.some(L)||Z.beforeHandle.some(L)||Z.transform.some(L),e1=E("parse",{unit:Z.parse.length});if(Z0){const I=S$(W?.body);if(Z.type&&!Array.isArray(Z.type)){if(Z.type)switch(Z.type){case"json":case"application/json":_+="c.body = await c.request.json()\n";break;case"text":case"text/plain":_+="c.body = await c.request.text()\n";break;case"urlencoded":case"application/x-www-form-urlencoded":_+="c.body = parseQuery(await c.request.text())\n";break;case"arrayBuffer":case"application/octet-stream":_+="c.body = await c.request.arrayBuffer()\n";break;case"formdata":case"multipart/form-data":_+=`c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}\n`;break}if(Z.parse.length)_+="}}"}else{const F=(()=>{if(Z.parse.length&&I&&!Array.isArray(Z.type)){const q=W?.body?.schema;switch(I){case"object":if(u0("File",q)||u0("Files",q))return`c.body = {}

								const form = await c.request.formData()
								for (const key of form.keys()) {
									if (c.body[key])
										continue

									const value = form.getAll(key)
									if (value.length === 1)
										c.body[key] = value[0]
									else c.body[key] = value
								}`;break;default:break}}})();if(F)_+=F;else{if(_+="\n",_+=h0?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",_+=`
				if (contentType) {
					const index = contentType.indexOf(';')
					if (index !== -1) contentType = contentType.substring(0, index)\n`,Z.parse.length){_+="let used = false\n";const q=E("parse",{unit:Z.parse.length});for(let C=0;C<Z.parse.length;C++){const d0=E("parse.unit",{name:Z.parse[C].name}),R=`bo${C}`;if(C!==0)_+="if(!used) {\n";if(_+=`let ${R} = parse[${C}](c, contentType)\n`,_+=`if(${R} instanceof Promise) ${R} = await ${R}\n`,_+=`if(${R} !== undefined) { c.body = ${R}; used = true }\n`,d0(),C!==0)_+="}"}q()}if(Z.parse.length)_+="if (!used)";_+=`
				switch (contentType) {
					case 'application/json':
						c.body = await c.request.json()
						break

					case 'text/plain':
						c.body = await c.request.text()
						break

					case 'application/x-www-form-urlencoded':
						c.body = parseQuery(await c.request.text())
						break

					case 'application/octet-stream':
						c.body = await c.request.arrayBuffer();
						break

					case 'multipart/form-data':
						c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}

						break
					}\n`,_+="}\n"}}_+="\n"}if(e1(),Z?.transform){const I=E("transform",{unit:Z.transform.length});for(let M=0;M<Z.transform.length;M++){const F=Z.transform[M],q=E("transform.unit",{name:F.name});if(F.$elysia==="derive")_+=L(F)?`Object.assign(c, await transform[${M}](c));`:`Object.assign(c, transform[${M}](c));`;else _+=L(F)?`await transform[${M}](c);`:`transform[${M}](c);`;q()}I()}if(W){if(_+="\n",W.headers){if(e("default",W.headers.params))for(let[I,M]of Object.entries(j0.Default(W.headers.schema,{}))){const F=typeof M==="object"?JSON.stringify(M):`'${M}'`;if(F)_+=`c.headers['${I}'] ??= ${F}\n`}if(_+=`if(headers.Check(c.headers) === false) {
				${W0("headers")}
			}`,$0(W.headers.schema))_+="\nc.headers = headers.Decode(c.headers)\n"}if(W.params){if(e("default",W.params.schema))for(let[I,M]of Object.entries(j0.Default(W.params.schema,{}))){const F=typeof M==="object"?JSON.stringify(M):`'${M}'`;if(F)_+=`c.params['${I}'] ??= ${F}\n`}if(_+=`if(params.Check(c.params) === false) {
				${W0("params")}
			}`,$0(W.params.schema))_+="\nc.params = params.Decode(c.params)\n"}if(W.query){if(e("default",W.query.schema))for(let[I,M]of Object.entries(j0.Default(W.query.schema,{}))){const F=typeof M==="object"?JSON.stringify(M):`'${M}'`;if(F)_+=`c.query['${I}'] ??= ${F}\n`}if(_+=`if(query.Check(c.query) === false) {
				${W0("query")}
			}`,$0(W.query.schema))_+="\nc.query = query.Decode(Object.assign({}, c.query))\n"}if(W.body){if(e("default",W.body.schema))_+=`if(body.Check(c.body) === false) {
    				c.body = Object.assign(${JSON.stringify(j0.Default(W.body.schema,null)??{})}, c.body)

    				if(body.Check(c.query) === false) {
        				${W0("body")}
     			}
            }`;else _+=`if(body.Check(c.body) === false) {
			${W0("body")}
		}`;if($0(W.body.schema))_+="\nc.body = body.Decode(c.body)\n"}if(m(W.cookie?.schema.properties??{})){if(_+=`const cookieValue = {}
    			for(const [key, value] of Object.entries(c.cookie))
    				cookieValue[key] = value.value\n`,e("default",W.cookie.schema))for(let[I,M]of Object.entries(j0.Default(W.cookie.schema,{})))_+=`cookieValue['${I}'] = ${typeof M==="object"?JSON.stringify(M):M}\n`;if(_+=`if(cookie.Check(cookieValue) === false) {
				${W0("cookie","cookieValue")}
			}`,$0(W.cookie.schema))_+="\nc.cookie = params.Decode(c.cookie)\n"}}if(Z?.beforeHandle){const I=E("beforeHandle",{unit:Z.beforeHandle.length});for(let M=0;M<Z.beforeHandle.length;M++){const F=Z.beforeHandle[M],q=E("beforeHandle.unit",{name:F.name}),C=V0(F.toString());if(F.$elysia==="resolve")_+=L(F)?`Object.assign(c, await beforeHandle[${M}](c));`:`Object.assign(c, beforeHandle[${M}](c));`;else if(!C)_+=L(F)?`await beforeHandle[${M}](c);\n`:`beforeHandle[${M}](c);\n`,q();else{_+=L(F)?`be = await beforeHandle[${M}](c);\n`:`be = beforeHandle[${M}](c);\n`,q(),_+="if(be !== undefined) {\n";const d0=E("afterHandle",{unit:Z.transform.length});if(Z.afterHandle){E("handle",{name:N?X.name:void 0})();for(let R=0;R<Z.afterHandle.length;R++){const $$=V0(Z.afterHandle[R].toString()),J$=E("afterHandle.unit",{name:Z.afterHandle[R].name});if(_+="c.response = be\n",!$$)_+=L(Z.afterHandle[R])?`await afterHandle[${R}](c, be)\n`:`afterHandle[${R}](c, be)\n`;else _+=L(Z.afterHandle[R])?`af = await afterHandle[${R}](c)\n`:`af = afterHandle[${R}](c)\n`,_+="if(af !== undefined) { c.response = be = af }\n";J$()}}if(d0(),W.response)_+=w0("be");if(Z.mapResponse.length){_+="c.response = be";for(let R=0;R<Z.mapResponse.length;R++)_+=`\nif(mr === undefined) {
							mr = onMapResponse[${R}](c)
							if(mr instanceof Promise) mr = await mr
							if(mr !== undefined) c.response = mr
						}\n`}_+=r,_+="return mapEarlyResponse(be, c.set)}\n"}}I()}if(Z?.afterHandle.length){const I=E("handle",{name:N?X.name:void 0});if(Z.afterHandle.length)_+=X0?`let r = c.response = await ${K};\n`:`let r = c.response = ${K};\n`;else _+=X0?`let r = await ${K};\n`:`let r = ${K};\n`;I();const M=E("afterHandle",{unit:Z.afterHandle.length});for(let F=0;F<Z.afterHandle.length;F++){const q=V0(Z.afterHandle[F].toString()),C=E("afterHandle.unit",{name:Z.afterHandle[F].name});if(!q)_+=L(Z.afterHandle[F])?`await afterHandle[${F}](c)\n`:`afterHandle[${F}](c)\n`,C();else if(_+=L(Z.afterHandle[F])?`af = await afterHandle[${F}](c)\n`:`af = afterHandle[${F}](c)\n`,C(),W.response)_+="if(af !== undefined) {",M(),_+=w0("af"),_+="c.response = af }";else _+="if(af !== undefined) {",M(),_+="c.response = af}\n"}if(M(),_+="r = c.response\n",W.response)_+=w0();if(_+=r,Z.mapResponse.length)for(let F=0;F<Z.mapResponse.length;F++)_+=`\nmr = onMapResponse[${F}](c)
				if(mr instanceof Promise) mr = await mr
				if(mr !== undefined) c.response = mr\n`;if(R0)_+="return mapResponse(r, c.set)\n";else _+="return mapCompactResponse(r)\n"}else{const I=E("handle",{name:N?X.name:void 0});if(W.response||Z.mapResponse.length){if(_+=X0?`let r = await ${K};\n`:`let r = ${K};\n`,I(),W.response)_+=w0();if(E("afterHandle")(),Z.mapResponse.length){_+="c.response = r";for(let M=0;M<Z.mapResponse.length;M++)_+=`\nif(mr === undefined) { 
						mr = onMapResponse[${M}](c)
						if(mr instanceof Promise) mr = await mr
    					if(mr !== undefined) r = c.response = mr
					}\n`}if(_+=r,X instanceof Response)_+=`return ${K}.clone()\n`;else if(R0)_+="return mapResponse(r, c.set)\n";else _+="return mapCompactResponse(r)\n"}else if(A.handle||q0){if(_+=X0?`let r = await ${K};\n`:`let r = ${K};\n`,I(),E("afterHandle")(),Z.mapResponse.length){_+="c.response = r";for(let M=0;M<Z.mapResponse.length;M++)_+=`\nif(mr === undefined) {
							mr = onMapResponse[${M}](c)
							if(mr instanceof Promise) mr = await mr
    						if(mr !== undefined) r = c.response = mr
						}\n`}if(_+=r,R0)_+="return mapResponse(r, c.set)\n";else _+="return mapCompactResponse(r)\n"}else{I();const M=X0?`await ${K}`:K;if(E("afterHandle")(),X instanceof Response)_+=`return ${K}.clone()\n`;else if(R0)_+=`return mapResponse(${M}, c.set)\n`;else _+=`return mapCompactResponse(${M})\n`}}if(V||j){if(_+=`
} catch(error) {`,!c0)_+="return (async () => {";_+=`const set = c.set

		if (!set.status || set.status < 300) set.status = error?.status || 500
	`;const I=E("error",{unit:Z.error.length});if(Z.error.length){_+=`
				c.error = error
				c.code = error.code ?? error[ERROR_CODE] ?? "UNKNOWN"
			`;for(let M=0;M<Z.error.length;M++){const F=`er${M}`,q=E("error.unit",{name:Z.error[M].name});if(_+=`\nlet ${F} = handleErrors[${M}](c)\n`,L(Z.error[M]))_+=`if (${F} instanceof Promise) ${F} = await ${F}\n`;q(),_+=`${F} = mapEarlyResponse(${F}, set)\n`,_+=`if (${F}) {`,_+=`return ${F} }\n`}}if(I(),_+="return handleError(c, error)\n\n",!c0)_+="})()";if(_+="}",j||T){_+=" finally { ";const M=E("response",{unit:Z.onResponse.length});_+=j,M(),_+="}"}}return _=`const {
		handler,
		handleError,
		hooks: {
			transform,
			resolve,
			beforeHandle,
			afterHandle,
			mapResponse: onMapResponse,
			parse,
			error: handleErrors,
			onResponse
		},
		validator: {
			body,
			headers,
			params,
			query,
			response,
			cookie
		},
		utils: {
			mapResponse,
			mapCompactResponse,
			mapEarlyResponse,
			parseQuery
		},
		error: {
			NotFoundError,
			ValidationError,
			InternalServerError
		},
		schema,
		definitions,
		ERROR_CODE,
		getReporter,
		requestId,
		parseCookie,
		signCookie,
		decodeURIComponent
	} = hooks

	${Z.onResponse.length?`const ${Z.onResponse.map((I,M)=>`res${M} = onResponse[${M}]`).join(",")}`:""}

	return ${c0?"async":""} function handle(c) {
		${Z.beforeHandle.length?"let be":""}
		${Z.afterHandle.length?"let af":""}
		${Z.mapResponse.length?"let mr":""}

		${D&&Y?"c.schema = schema; c.defs = definitions;":""}
		${_}
	}`,Function("hooks",_)({handler:X,hooks:Z,validator:W,handleError:B,utils:{mapResponse:k,mapCompactResponse:l,mapEarlyResponse:y,parseQuery:d1.parse},error:{NotFoundError:o,ValidationError:S,InternalServerError:k0},schema:D,definitions:Y,ERROR_CODE:G0,getReporter:z,requestId:l1,parseCookie:g0,signCookie:D0,decodeURIComponent:p1.default})},Q1=($)=>{let J="",Z="";for(let K of Object.keys($.decorators))J+=`,${K}: app.decorators.${K}`;const{router:W,staticRouter:X}=$,B=$.event.trace.length>0,Y=`
	const route = router.find(request.method, path) ${W.root.ALL?'?? router.find("ALL", path)':""}
	if (route === null)
		return ${$.event.error.length?"app.handleError(ctx, notFound)":$.event.request.length?`new Response(error404Message, {
					status: ctx.set.status === 200 ? 404 : ctx.set.status,
					headers: ctx.set.headers
				})`:"error404.clone()"}

	ctx.params = route.params

	return route.store(ctx)`;let D="";for(let[K,{code:j,all:O}]of Object.entries(X.map))D+=`case '${K}':\nswitch(request.method) {\n${j}\n${O??"default: break map"}}\n\n`;const Q=$.event.request.some(L);if(Z+=`const {
		app,
		app: { store, router, staticRouter, wsRouter },
		mapEarlyResponse,
		NotFoundError,
		requestId,
		getReporter,
		handleError
	} = data

	const notFound = new NotFoundError()

	${$.event.request.length?"const onRequest = app.event.request":""}
	${X.variables}
	${$.event.error.length?"":`
	const error404Message = notFound.message.toString()
	const error404 = new Response(error404Message, { status: 404 });
	`}

	return ${Q?"async":""} function map(request) {\n`,$.event.request.length)Z+="let re";const G=$.event.trace.map((K)=>K.toString()),z=n1({hasTrace:B,hasTraceSet:$.event.trace.some((K)=>{const j=K.toString();return b("set",j)||T0(j)}),condition:{request:G.some((K)=>b("request",K)||T0(K))},addFn:(K)=>{Z+=K}});if($.event.request.length){Z+=`
			${B?"const id = +requestId.value++":""}

			const ctx = {
				request,
				store,
				set: {
					headers: ${Object.keys($.setHeaders??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
					status: 200
				}
				${B?",$$requestId: +id":""}
				${J}
			}
		`;const K=z("request",{attribute:"ctx",unit:$.event.request.length});Z+="\n try {\n";for(let j=0;j<$.event.request.length;j++){const O=$.event.request[j],P=V0(O.toString()),A=L(O),T=z("request.unit",{name:$.event.request[j].name});if(P){if(Z+=`re = mapEarlyResponse(
					${A?"await":""} onRequest[${j}](ctx),
					ctx.set
				)\n`,T(),P)Z+="if(re !== undefined) return re\n"}else Z+=`${A?"await":""} onRequest[${j}](ctx)\n`,T()}Z+=`} catch (error) {
			return app.handleError(ctx, error)
		}`,K(),Z+=`
		const url = request.url
		const s = url.indexOf('/', 11)
		const qi = ctx.qi = url.indexOf('?', s + 1)
		const path = ctx.path = url.substring(s, qi === -1 ? undefined : qi)`}else Z+=`
		const url = request.url
		const s = url.indexOf('/', 11)
		const qi = url.indexOf('?', s + 1)
		const path = url.substring(s, qi === -1 ? undefined : qi)
		${B?"const id = +requestId.value++":""}
		const ctx = {
			request,
			store,
			qi,
			path,
			set: {
				headers: ${Object.keys($.setHeaders??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
				status: 200
			}
			${B?",$$requestId: id":""}
			${J}
		}`,z("request",{unit:$.event.request.length,attribute:G.some((K)=>b("context",K))||G.some((K)=>b("store",K))||G.some((K)=>b("set",K))?"ctx":""})();const{wsPaths:U,wsRouter:V}=$;if(Object.keys(U).length||V.history.length){Z+=`
			if(request.method === 'GET') {
				switch(path) {`;for(let[K,j]of Object.entries(U))Z+=`
					case '${K}':
						if(request.headers.get('upgrade') === 'websocket')
							return st${j}(ctx)

						break`;Z+=`
				default:
					if(request.headers.get('upgrade') === 'websocket') {
						const route = wsRouter.find('ws', path)

						if(route) {
							ctx.params = route.params

							return route.store(ctx)
						}
					}

					break
			}
		}\n`}Z+=`
		map: switch(path) {
			${D}

			default:
				break
		}

		${Y}
	}`;const N=_1($);return $.handleError=N,Function("data",Z)({app:$,mapEarlyResponse:y,NotFoundError:o,getReporter:()=>$.reporter,requestId:l1,handleError:N})},_1=($)=>{let J=`const {
		app: { event: { error: onError, onResponse: res } },
		mapResponse,
		ERROR_CODE,
		ELYSIA_RESPONSE
	} = inject

	return ${$.event.error.find(L)?"async":""} function(context, error) {
		let r

		const { set } = context

		context.code = error.code
		context.error = error

		if(error[ELYSIA_RESPONSE]) {
			error.status = error[ELYSIA_RESPONSE]
			error.message = error.response
		}
`;for(let Z=0;Z<$.event.error.length;Z++){const W=$.event.error[Z],X=`${L(W)?"await ":""}onError[${Z}](context)`;if(V0(W.toString()))J+=`r = ${X}; if(r !== undefined) {
				if(r instanceof Response) return r

				if(r[ELYSIA_RESPONSE]) {
					error.status = error[ELYSIA_RESPONSE]
					error.message = error.response
				}
		
				if(set.status === 200) set.status = error.status
				return mapResponse(r, set)
			}\n`;else J+=X+"\n"}return J+=`if(error.constructor.name === "ValidationError" || error.constructor.name === "TransformDecodeError") {
		set.status = error.status ?? 400
		return new Response(
			error.message,
			{ headers: set.headers, status: set.status }
		)
	} else {
		if(error.code && typeof error.status === "number")
			return new Response(
				error.message,
				{ headers: set.headers, status: error.status }
			)

		return mapResponse(error, set)
	}
}`,Function("inject",J)({app:$,mapResponse:k,ERROR_CODE:G0,ELYSIA_RESPONSE:c})};var m0=S0(B1(),1);var D1=($)=>async(J)=>{const Z={cookie:{},status:200,headers:{}};let W;if($.decorators)W=$.decorators,W.request=J,W.set=Z,W.store=$.store;else W={set:Z,store:$.store,request:J};const X=J.url,B=X.indexOf("/",11),Y=X.indexOf("?",B+1),D=Y===-1?X.substring(B):X.substring(B,Y);try{for(let O=0;O<$.event.request.length;O++){const P=$.event.request[O];let A=P(W);if(A instanceof Promise)A=await A;if(A=y(A,Z),A)return A}const Q=$.dynamicRouter.find(J.method,D)??$.dynamicRouter.find("ALL",D);if(!Q)throw new o;const{handle:G,hooks:z,validator:U,content:V}=Q.store;let N;if(J.method!=="GET"&&J.method!=="HEAD")if(V)switch(V){case"application/json":N=await J.json();break;case"text/plain":N=await J.text();break;case"application/x-www-form-urlencoded":N=m0.parse(await J.text());break;case"application/octet-stream":N=await J.arrayBuffer();break;case"multipart/form-data":N={};const O=await J.formData();for(let P of O.keys()){if(N[P])continue;const A=O.getAll(P);if(A.length===1)N[P]=A[0];else N[P]=A}break}else{let O=J.headers.get("content-type");if(O){const P=O.indexOf(";");if(P!==-1)O=O.slice(0,P);for(let A=0;A<$.event.parse.length;A++){let T=$.event.parse[A](W,O);if(T instanceof Promise)T=await T;if(T){N=T;break}}if(N===void 0)switch(O){case"application/json":N=await J.json();break;case"text/plain":N=await J.text();break;case"application/x-www-form-urlencoded":N=m0.parse(await J.text());break;case"application/octet-stream":N=await J.arrayBuffer();break;case"multipart/form-data":N={};const A=await J.formData();for(let T of A.keys()){if(N[T])continue;const _=A.getAll(T);if(_.length===1)N[T]=_[0];else N[T]=_}break}}}W.body=N,W.params=Q?.params||void 0,W.query=Y===-1?{}:m0.parse(X.substring(Y+1)),W.headers={};for(let[O,P]of J.headers.entries())W.headers[O]=P;const K=U?.cookie?.schema;W.cookie=await g0(W.set,W.headers.cookie,K?{secret:K.secrets!==void 0?typeof K.secrets==="string"?K.secrets:K.secrets.join(","):void 0,sign:K.sign===!0?!0:K.sign!==void 0?typeof K.sign==="string"?K.sign:K.sign.join(","):void 0}:void 0);for(let O=0;O<z.transform.length;O++){const P=z.transform[O](W);if(z.transform[O].$elysia==="derive")if(P instanceof Promise)Object.assign(W,await P);else Object.assign(W,P);else if(P instanceof Promise)await P}if(U){if(U.headers){const O={};for(let P in J.headers)O[P]=J.headers.get(P);if(U.headers.Check(O)===!1)throw new S("header",U.headers,O)}if(U.params?.Check(W.params)===!1)throw new S("params",U.params,W.params);if(U.query?.Check(W.query)===!1)throw new S("query",U.query,W.query);if(U.cookie){const O={};for(let[P,A]of Object.entries(W.cookie))O[P]=A.value;if(U.cookie?.Check(O)===!1)throw new S("cookie",U.cookie,O)}if(U.body?.Check(N)===!1)throw new S("body",U.body,N)}for(let O=0;O<z.beforeHandle.length;O++){let P=z.beforeHandle[O](W);if(P instanceof Promise)P=await P;if(P!==void 0){W.response=P;for(let T=0;T<z.afterHandle.length;T++){let _=z.afterHandle[T](W);if(_ instanceof Promise)_=await _;if(_)P=_}const A=y(P,W.set);if(A)return A}}let j=G(W);if(j instanceof Promise)j=await j;if(!z.afterHandle.length){const O=U?.response?.[j.status];if(O?.Check(j)===!1)throw new S("response",O,j)}else{W.response=j;for(let O=0;O<z.afterHandle.length;O++){let P=z.afterHandle[O](W);if(P instanceof Promise)P=await P;const A=y(P,W.set);if(A!==void 0){const T=U?.response?.[j.status];if(T?.Check(A)===!1)throw new S("response",T,A);return A}}}if(W.set.cookie&&K?.sign){const O=!K.secrets?void 0:typeof K.secrets==="string"?K.secrets:K.secrets[0];if(K.sign===!0)for(let[P,A]of Object.entries(W.set.cookie))W.set.cookie[P].value=await D0(A.value,"${secret}");else for(let P of K.sign){if(!(P in K.properties))continue;if(W.set.cookie[P]?.value)W.set.cookie[P].value=await D0(W.set.cookie[P].value,O)}}return k(j,W.set)}catch(Q){if(Q.status)Z.status=Q.status;return $.handleError(W,Q)}finally{for(let Q of $.event.onResponse)await Q(W)}},t1=($)=>async(J,Z)=>{const W=Object.assign(J,{error:Z,code:Z.code});W.set=J.set;for(let X=0;X<$.event.error.length;X++){let B=$.event.error[X](W);if(B instanceof Promise)B=await B;if(B!==void 0&&B!==null)return k(B,J.set)}return new Response(typeof Z.cause==="string"?Z.cause:Z.message,{headers:J.set.headers,status:Z.status??500})};import{TypeSystem as U0} from"@sinclair/typebox/system";import{Type as s1,FormatRegistry as o1} from"@sinclair/typebox";import{Value as b$} from"@sinclair/typebox/value";import{TypeSystemPolicy as v7,TypeSystem as k7,TypeSystemDuplicateFormat as u7,TypeSystemDuplicateTypeKind as m7} from"@sinclair/typebox/system";import{TypeCompiler as c7,TypeCheck as d7} from"@sinclair/typebox/compiler";var w=Object.assign({},s1);try{U0.Format("email",($)=>/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test($)),U0.Format("uuid",($)=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test($)),U0.Format("date",($)=>!Number.isNaN(new Date($).getTime())),U0.Format("date-time",($)=>!Number.isNaN(new Date($).getTime()))}catch{}var a1=($)=>{if(typeof $==="string")switch($.slice(-1)){case"k":return+$.slice(0,$.length-1)*1024;case"m":return+$.slice(0,$.length-1)*1048576;default:return+$}return $},G1=($,J)=>{if(!(J instanceof Blob))return!1;if($.minSize&&J.size<a1($.minSize))return!1;if($.maxSize&&J.size>a1($.maxSize))return!1;if($.extension)if(typeof $.extension==="string"){if(!J.type.startsWith($.extension))return!1}else{for(let Z=0;Z<$.extension.length;Z++)if(J.type.startsWith($.extension[Z]))return!0;return!1}return!0},L$=U0.Type("Files",($,J)=>{if(!Array.isArray(J))return G1($,J);if($.minItems&&J.length<$.minItems)return!1;if($.maxItems&&J.length>$.maxItems)return!1;for(let Z=0;Z<J.length;Z++)if(!G1($,J[Z]))return!1;return!0});o1.Set("numeric",($)=>!!$&&!isNaN(+$));o1.Set("ObjectString",($)=>{let J=$.charCodeAt(0);if(J===9||J===10||J===32)J=$.trimStart().charCodeAt(0);if(J!==123&&J!==91)return!1;try{return JSON.parse($),!0}catch{return!1}});var J0={Numeric:($)=>{const J=s1.Number($);return w.Transform(w.Union([w.String({format:"numeric",default:0}),w.Number($)],$)).Decode((Z)=>{const W=+Z;if(isNaN(W))return Z;if($&&!b$.Check(J,W))throw new S("property",J,W);return W}).Encode((Z)=>Z)},ObjectString:($,J)=>w.Transform(w.Union([w.String({format:"ObjectString",default:""}),w.Object($,J)],J)).Decode((Z)=>{if(typeof Z==="string")try{return JSON.parse(Z)}catch{return Z}return Z}).Encode((Z)=>JSON.stringify(Z)),File:U0.Type("File",G1),Files:($={})=>w.Transform(w.Union([L$($)])).Decode((J)=>{if(Array.isArray(J))return J;return[J]}).Encode((J)=>J),Nullable:($)=>w.Union([w.Null(),$]),MaybeEmpty:($)=>w.Union([w.Null(),w.Undefined(),$]),Cookie:($,J)=>w.Object($,J)};w.ObjectString=J0.ObjectString;w.Numeric=J0.Numeric;w.File=($={})=>J0.File({default:"File",...$,extension:$?.type,type:"string",format:"binary"});w.Files=($={})=>J0.Files({...$,elysiaMeta:"Files",default:"Files",extension:$?.type,type:"array",items:{...$,default:"Files",type:"string",format:"binary"}});w.Nullable=($)=>J0.Nullable($);w.MaybeEmpty=J0.MaybeEmpty;w.Cookie=J0.Cookie;class n{config;dependencies={};store={};decorators={};definitions={type:{},error:{}};schema={};macros=[];event={start:[],request:[],parse:[],transform:[],beforeHandle:[],afterHandle:[],mapResponse:[],onResponse:[],trace:[],error:[],stop:[]};reporter=new A1;server=null;getServer(){return this.server}validator=null;router=new s;wsRouter=new s;routes=[];staticRouter={handlers:[],variables:"",map:{},all:""};wsPaths={};dynamicRouter=new s;lazyLoadModules=[];path="";stack=void 0;constructor($){if(this.config={forceErrorEncapsulation:!0,prefix:"",aot:!0,strictPath:!1,scoped:!1,cookie:{},analytic:!1,...$,seed:$?.seed===void 0?"":$?.seed},$?.analytic&&($?.name||$?.seed!==void 0))this.stack=new Error().stack}add($,J,Z,W,{allowMeta:X=!1,skipPrefix:B=!1}={allowMeta:!1,skipPrefix:!1}){if(typeof J==="string")J=[J];for(let Y of J){if(Y=Y===""?Y:Y.charCodeAt(0)===47?Y:`/${Y}`,this.config.prefix&&!B)Y=this.config.prefix+Y;if(W?.type)switch(W.type){case"text":W.type="text/plain";break;case"json":W.type="application/json";break;case"formdata":W.type="multipart/form-data";break;case"urlencoded":W.type="application/x-www-form-urlencoded";break;case"arrayBuffer":W.type="application/octet-stream";break;default:break}const D=this.definitions.type;let Q=p(W?.cookie??this.validator?.cookie,{dynamic:!this.config.aot,models:D,additionalProperties:!0});if(m(this.config.cookie??{}))if(Q)Q.schema=T1(Q.schema,this.config.cookie??{});else Q=p(w.Cookie({},this.config.cookie),{dynamic:!this.config.aot,models:D,additionalProperties:!0});const G={body:p(W?.body??this.validator?.body,{dynamic:!this.config.aot,models:D}),headers:p(W?.headers??this.validator?.headers,{dynamic:!this.config.aot,models:D,additionalProperties:!0}),params:p(W?.params??this.validator?.params,{dynamic:!this.config.aot,models:D}),query:p(W?.query??this.validator?.query,{dynamic:!this.config.aot,models:D}),cookie:Q,response:s0(W?.response??this.validator?.response,{dynamic:!this.config.aot,models:D})},z=this.event,U=Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/";if(this.macros.length){const O=(A)=>(T,_)=>{if(typeof T==="function"||Array.isArray(T)){if(!W[A])W[A]=[];if(typeof W[A]==="function")W[A]=[W[A]];if(Array.isArray(T))W[A]=W[A].concat(T);else W[A].push(T);return}const{insert:v="after",stack:Z0="local"}=T;if(Z0==="global"){if(!Array.isArray(_))if(v==="before")z[A].unshift(_);else z[A].push(_);else if(v==="before")z[A]=_.concat(z[A]);else z[A]=z[A].concat(_);return}else{if(!W[A])W[A]=[];if(typeof W[A]==="function")W[A]=[W[A]];if(!Array.isArray(_))if(v==="before")W[A].unshift(_);else W[A].push(_);else if(v==="before")W[A]=_.concat(W[A]);else W[A]=W[A].concat(_);return}},P={events:{global:z,local:W},onParse:O("parse"),onTransform:O("transform"),onBeforeHandle:O("beforeHandle"),onAfterHandle:O("afterHandle"),onResponse:O("onResponse"),onError:O("error")};for(let A of this.macros){const T={};for(let[v,Z0]of Object.entries(W??{})){if(a0.includes(v))continue;T[v]=Z0}if(!A.$elysiaChecksum)A.$elysiaChecksum=[];const _=_0(JSON.stringify(T));if(A.$elysiaChecksum.includes(_))continue;A.$elysiaChecksum.push(_0(JSON.stringify(T))),e0(A(P),W)}}const V=a(z,W),N=typeof Z==="function";if(this.config.aot===!1){if(this.dynamicRouter.add($,Y,{validator:G,hooks:V,content:W?.type,handle:Z}),this.config.strictPath===!1)this.dynamicRouter.add($,U,{validator:G,hooks:V,content:W?.type,handle:Z});this.routes.push({method:$,path:Y,composed:null,handler:Z,hooks:V});return}const K=r1({path:Y,method:$,hooks:V,validator:G,handler:Z,handleError:this.handleError,onRequest:this.event.request,config:this.config,definitions:X?this.definitions.type:void 0,schema:X?this.schema:void 0,getReporter:()=>this.reporter,setHeader:this.setHeaders});if(!N){const O=Object.assign({headers:{},query:{},params:{},body:void 0,request:new Request(`http://localhost${Y}`),store:this.store,path:Y,set:{headers:this.setHeaders??{},status:200}},this.decorators);let P;for(let A of Object.values(V.request))try{const T=y(A(O),O.set);if(T!==void 0){P=T;break}}catch(T){P=this.handleError(O,T);break}if(P)K.response=P;else try{K.response=K(O)}catch(A){K.response=this.handleError(O,A)}}const j=this.routes.findIndex((O)=>O.path===Y&&O.method===$);if(j!==-1)this.routes.splice(j,1);if(this.routes.push({method:$,path:Y,composed:K,handler:Z,hooks:V}),$==="$INTERNALWS"){const O=this.config.strictPath?void 0:Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/";if(Y.indexOf(":")===-1&&Y.indexOf("*")===-1){const P=this.staticRouter.handlers.length;if(this.staticRouter.handlers.push(K),K.response instanceof Response)this.staticRouter.variables+=`const st${P} = staticRouter.handlers[${P}].response\n`;else this.staticRouter.variables+=`const st${P} = staticRouter.handlers[${P}]\n`;if(this.wsPaths[Y]=P,O)this.wsPaths[O]=P}else if(this.wsRouter.add("ws",Y,K),O)this.wsRouter.add("ws",O,K);return}if(Y.indexOf(":")===-1&&Y.indexOf("*")===-1){const O=this.staticRouter.handlers.length;if(this.staticRouter.handlers.push(K),K.response instanceof Response)this.staticRouter.variables+=`const st${O} = staticRouter.handlers[${O}].response\n`;else this.staticRouter.variables+=`const st${O} = staticRouter.handlers[${O}]\n`;if(!this.staticRouter.map[Y])this.staticRouter.map[Y]={code:""};if($==="ALL")this.staticRouter.map[Y].all=`default: return st${O}(ctx)\n`;else if(K.response instanceof Response)this.staticRouter.map[Y].code=`case '${$}': return st${O}.clone()\n${this.staticRouter.map[Y].code}`;else this.staticRouter.map[Y].code=`case '${$}': return st${O}(ctx)\n${this.staticRouter.map[Y].code}`;if(!this.config.strictPath){if(!this.staticRouter.map[U])this.staticRouter.map[U]={code:""};if($==="ALL")this.staticRouter.map[U].all=`default: return st${O}(ctx)\n`;else if(K.response instanceof Response)this.staticRouter.map[U].code=`case '${$}': return st${O}.clone()\n${this.staticRouter.map[U].code}`;else this.staticRouter.map[U].code=`case '${$}': return st${O}(ctx)\n${this.staticRouter.map[U].code}`}}else if(this.router.add($,Y,K),!this.config.strictPath)this.router.add($,Y.endsWith("/")?Y.slice(0,Y.length-1):Y+"/",K)}}setHeaders;headers($){if(!$)return this;if(!this.setHeaders)this.setHeaders={};return this.setHeaders=d(this.setHeaders,$),this}onStart($){return this.on("start",$),this}onRequest($){return this.on("request",$),this}onParse($){return this.on("parse",$),this}onTransform($){return this.on("transform",$),this}resolve($){return $.$elysia="resolve",this.onBeforeHandle($)}onBeforeHandle($){return this.on("beforeHandle",$),this}onAfterHandle($){return this.on("afterHandle",$),this}mapResponse($){return this.on("mapResponse",$),this}onResponse($){return this.on("response",$),this}trace($){return this.reporter.on("event",P1(()=>this.reporter,this.event.trace.length,$)),this.on("trace",$),this}error($,J){switch(typeof $){case"string":return J.prototype[G0]=$,this.definitions.error[$]=J,this;case"function":return this.definitions.error=$(this.definitions.error),this}for(let[Z,W]of Object.entries($))W.prototype[G0]=Z,this.definitions.error[Z]=W;return this}onError($){return this.on("error",$),this}onStop($){return this.on("stop",$),this}on($,J){for(let Z of Array.isArray(J)?J:[J])switch(Z=q1(Z),$){case"start":this.event.start.push(Z);break;case"request":this.event.request.push(Z);break;case"parse":this.event.parse.splice(this.event.parse.length-1,0,Z);break;case"transform":this.event.transform.push(Z);break;case"beforeHandle":this.event.beforeHandle.push(Z);break;case"afterHandle":this.event.afterHandle.push(Z);break;case"mapResponse":this.event.mapResponse.push(Z);break;case"response":this.event.onResponse.push(Z);break;case"trace":this.event.trace.push(Z);break;case"error":this.event.error.push(Z);break;case"stop":this.event.stop.push(Z);break}return this}group($,J,Z){const W=new n({...this.config,prefix:""});W.store=this.store,W.definitions=this.definitions,W.getServer=()=>this.server;const X=typeof J==="object",B=(X?Z:J)(W);if(this.decorators=d(this.decorators,W.decorators),B.event.request.length)this.event.request=[...this.event.request,...B.event.request];if(B.event.onResponse.length)this.event.onResponse=[...this.event.onResponse,...B.event.onResponse];return this.model(B.definitions.type),Object.values(W.routes).forEach(({method:Y,path:D,handler:Q,hooks:G})=>{if(D=(X?"":this.config.prefix)+$+D,X){const z=J,U=G;this.add(Y,D,Q,a(z,{...U,error:!U.error?B.event.error:Array.isArray(U.error)?[...U.error,...B.event.error]:[U.error,...B.event.error]}))}else this.add(Y,D,Q,a(G,{error:B.event.error}),{skipPrefix:!0})}),this}guard($,J){if(!J)return this.event=v0(this.event,$),this.validator={body:$.body,headers:$.headers,params:$.params,query:$.query,response:$.response},this;const Z=new n({...this.config,prefix:""});Z.store=this.store,Z.definitions=this.definitions;const W=J(Z);if(this.decorators=d(this.decorators,Z.decorators),W.event.request.length)this.event.request=[...this.event.request,...W.event.request];if(W.event.onResponse.length)this.event.onResponse=[...this.event.onResponse,...W.event.onResponse];return this.model(W.definitions.type),Object.values(Z.routes).forEach(({method:X,path:B,handler:Y,hooks:D})=>{this.add(X,B,Y,a($,{...D,error:!D.error?W.event.error:Array.isArray(D.error)?[...D.error,...W.event.error]:[D.error,...W.event.error]}))}),this}use($){if($ instanceof Promise)return this.lazyLoadModules.push($.then((J)=>{if(typeof J==="function")return J(this);if(typeof J.default==="function")return J.default(this);return this._use(J)}).then((J)=>J.compile())),this;else return this._use($);return this}_use($){if(typeof $==="function"){const X=$(this);if(X instanceof Promise)return this.lazyLoadModules.push(X.then((B)=>{if(B instanceof n){this.compile();for(let{method:Y,path:D,handler:Q,hooks:G}of Object.values(B.routes))this.add(Y,D,Q,a(G,{error:B.event.error}));return B}if(typeof B==="function")return B(this);if(typeof B.default==="function")return B.default(this);return this._use(B)}).then((B)=>B.compile())),this;return X}const{name:J,seed:Z}=$.config;$.getServer=()=>this.getServer(),this.headers($.setHeaders);const W=$.config.scoped;if(W){if(J){if(!(J in this.dependencies))this.dependencies[J]=[];const B=Z!==void 0?_0(J+JSON.stringify(Z)):0;if(this.dependencies[J].some(({checksum:Y})=>B===Y))return this;this.dependencies[J].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:B,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:B,dependencies:$.dependencies,stack:$.stack,routes:$.routes,decorators:$.decorators,store:$.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((Y)=>Y.$elysia==="derive").map((Y)=>({fn:Y.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((Y)=>Y.$elysia==="derive").map((Y)=>({fn:Y.toString(),stack:new Error().stack??""}))})}if($.model(this.definitions.type),$.error(this.definitions.error),$.macros=[...this.macros,...$.macros],$.onRequest((B)=>{Object.assign(B,this.decorators),Object.assign(B.store,this.store)}),$.event.trace=[...this.event.trace,...$.event.trace],$.config.aot)$.compile();const X=this.mount($.fetch);return this.routes=this.routes.concat(X.routes),this}else{$.reporter=this.reporter;for(let X of $.event.trace)this.trace(X);if(J){if(!(J in this.dependencies))this.dependencies[J]=[];const X=Z!==void 0?_0(J+JSON.stringify(Z)):0;if(!this.dependencies[J].some(({checksum:B})=>X===B))this.macros.push(...$.macros)}}this.decorate($.decorators),this.state($.store),this.model($.definitions.type),this.error($.definitions.error);for(let{method:X,path:B,handler:Y,hooks:D}of Object.values($.routes))this.add(X,B,Y,a(D,{error:$.event.error}));if(!W)if(J){if(!(J in this.dependencies))this.dependencies[J]=[];const X=Z!==void 0?_0(J+JSON.stringify(Z)):0;if(this.dependencies[J].some(({checksum:B})=>X===B))return this;this.dependencies[J].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:X,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:X,dependencies:$.dependencies,stack:$.stack,routes:$.routes,decorators:$.decorators,store:$.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((B)=>B?.$elysia==="derive").map((B)=>({fn:B.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((B)=>B?.$elysia==="resolve").map((B)=>({fn:B.toString(),stack:new Error().stack??""}))}),this.event=v0(this.event,o0($.event),X)}else this.event=v0(this.event,o0($.event));return this}macro($){return this.macros.push($),this}mount($,J){if($ instanceof n||typeof $==="function"||$.length===0||$==="/"){const X=typeof $==="function"?$:$ instanceof n?$.compile().fetch:J instanceof n?J.compile().fetch:J,B=async({request:Y,path:D})=>X(new Request(t0(Y.url,D||"/"),Y));return this.all("/",B,{type:"none"}),this.all("/*",B,{type:"none"}),this}const Z=$.length;if(J instanceof n)J=J.compile().fetch;const W=async({request:X,path:B})=>J(new Request(t0(X.url,B.slice(Z)||"/"),X));return this.all($,W,{type:"none"}),this.all($+($.endsWith("/")?"*":"/*"),W,{type:"none"}),this}get($,J,Z){return this.add("GET",$,J,Z),this}post($,J,Z){return this.add("POST",$,J,Z),this}put($,J,Z){return this.add("PUT",$,J,Z),this}patch($,J,Z){return this.add("PATCH",$,J,Z),this}delete($,J,Z){return this.add("DELETE",$,J,Z),this}options($,J,Z){return this.add("OPTIONS",$,J,Z),this}all($,J,Z){return this.add("ALL",$,J,Z),this}head($,J,Z){return this.add("HEAD",$,J,Z),this}connect($,J,Z){return this.add("CONNECT",$,J,Z),this}ws($,J){const Z=J.transformMessage?Array.isArray(J.transformMessage)?J.transformMessage:[J.transformMessage]:void 0;let W=null;const X=p(J?.body,{models:this.definitions.type}),B=p(J?.response,{models:this.definitions.type}),Y=(D)=>{if(typeof D==="string"){const Q=D?.charCodeAt(0);if(Q===47||Q===123)try{D=JSON.parse(D)}catch{}else if(f0(D))D=+D}if(Z?.length)for(let Q=0;Q<Z.length;Q++){const G=Z[Q](D);if(G!==void 0)D=G}return D};return this.route("$INTERNALWS",$,(D)=>{const{set:Q,path:G,qi:z,headers:U,query:V,params:N}=D;if(W===null)W=this.getServer();if(W?.upgrade(D.request,{headers:typeof J.upgrade==="function"?J.upgrade(D):J.upgrade,data:{validator:B,open(K){J.open?.(new z0(K,D))},message:(K,j)=>{const O=Y(j);if(X?.Check(O)===!1)return void K.send(new S("message",X,O).message);J.message?.(new z0(K,D),O)},drain(K){J.drain?.(new z0(K,D))},close(K,j,O){J.close?.(new z0(K,D),j,O)}}}))return;return Q.status=400,"Expected a websocket connection"},{beforeHandle:J.beforeHandle,transform:J.transform,headers:J.headers,params:J.params,query:J.query}),this}route($,J,Z,{config:W,...X}={config:{allowMeta:!1}}){return this.add($,J,Z,X,W),this}state($,J){switch(typeof $){case"object":return this.store=d(this.store,$),this;case"function":return this.store=$(this.store),this}if(!($ in this.store))this.store[$]=J;return this}decorate($,J){switch(typeof $){case"object":return this.decorators=d(this.decorators,$),this;case"function":return this.decorators=$(this.decorators),this}if(!($ in this.decorators))this.decorators[$]=J;return this}derive($){return $.$elysia="derive",this.onTransform($)}model($,J){switch(typeof $){case"object":return Object.entries($).forEach(([Z,W])=>{if(!(Z in this.definitions.type))this.definitions.type[Z]=W}),this;case"function":return this.definitions.type=$(this.definitions.type),this}return this.definitions.type[$]=J,this}mapDerive($){return $.$elysia="derive",this.onTransform($)}affix($,J,Z){if(Z==="")return this;const W=["_","-"," "],X=(Q)=>Q[0].toUpperCase()+Q.slice(1),B=$==="prefix"?(Q,G)=>W.includes(Q.at(-1)??"")?Q+G:Q+X(G):W.includes(Z.at(-1)??"")?(Q,G)=>G+Q:(Q,G)=>G+X(Q),Y=(Q)=>{const G={};switch(Q){case"decorator":for(let z in this.decorators)G[B(Z,z)]=this.decorators[z];this.decorators=G;break;case"state":for(let z in this.store)G[B(Z,z)]=this.store[z];this.store=G;break;case"model":for(let z in this.definitions.type)G[B(Z,z)]=this.definitions.type[z];this.definitions.type=G;break;case"error":for(let z in this.definitions.error)G[B(Z,z)]=this.definitions.error[z];this.definitions.error=G;break}},D=Array.isArray(J)?J:[J];for(let Q of D.some((G)=>G==="all")?["decorator","state","model","error"]:D)Y(Q);return this}prefix($,J){return this.affix("prefix",$,J)}suffix($,J){return this.affix("suffix",$,J)}compile(){if(this.fetch=this.config.aot?Q1(this):D1(this),typeof this.server?.reload==="function")this.server.reload({...this.server,fetch:this.fetch});return this}handle=async($)=>this.fetch($);fetch=($)=>{return(this.fetch=this.config.aot?Q1(this):D1(this))($)};handleError=async($,J)=>(this.handleError=this.config.aot?_1(this):t1(this))($,J);outerErrorHandler=($)=>new Response($.message||$.name||"Error",{status:$?.status??500});listen=($,J)=>{if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(this.compile(),typeof $==="string"){if($=+$.trim(),Number.isNaN($))throw new Error("Port must be a numeric value")}const Z=this.fetch,W=typeof $==="object"?{development:!F0,reusePort:!0,...this.config.serve,...$,websocket:{...this.config.websocket,...J1},fetch:Z,error:this.outerErrorHandler}:{development:!F0,reusePort:!0,...this.config.serve,websocket:{...this.config.websocket,...J1},port:$,fetch:Z,error:this.outerErrorHandler};if(this.server=Bun?.serve(W),this.event.start.length)for(let X=0;X<this.event.start.length;X++)this.event.start[X](this);if(J)J(this.server);return process.on("beforeExit",()=>{for(let X=0;X<this.event.stop.length;X++)this.event.stop[X](this)}),Promise.all(this.lazyLoadModules).then(()=>{Bun?.gc(!1)}),this};stop=async()=>{if(!this.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(this.server.stop(),this.event.stop.length)for(let $=0;$<this.event.stop.length;$++)this.event.stop[$](this)};get modules(){return Promise.all(this.lazyLoadModules)}}export{w as t,H as mergeObjectArray,a as mergeHook,d as mergeDeep,k as mapResponse,y as mapEarlyResponse,l as mapCompactResponse,p as getSchemaValidator,s0 as getResponseSchemaValidator,P$ as error,n as default,S as ValidationError,C1 as ParseError,o as NotFoundError,I0 as InvalidCookieSignature,k0 as InternalServerError,n as Elysia,u as Cookie};

//# debugId=7B27E0609AB480E364756e2164756e21
